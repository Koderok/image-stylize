im = imread('lena.png');

C = makecform('srgb2lab');
im = applycform(im, C);
imshow(im);
[r, c, ~] = size(im);
image = zeros(r, c);
for i=1:r
    for j=1:c
        image(i, j) = im(i, j, 1);
    end
end

xdog_output = xdog(image);
quant_result = median_cut(image,3);
quant_result = quant_result/256.0;

filter = fspecial('gaussian', 15, 3);
quant_result = conv2(quant_result, filter, 'same');

[m n] = size(image);
output = zeros(m,n);
for i=1:m
    for j=1:n
        output(i,j) = xdog_output(i,j)*quant_result(i,j);
    end
end

for i=1:r
    for j=1:c
        im(i, j, 1) = output(i, j);
    end
end

C = makecform('lab2srgb');
im = applycform(im, C);
figure, imshow(im);
figure, imshow(output);
